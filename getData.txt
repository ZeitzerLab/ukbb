#!/bin/bash

# Set Environment variables
DATARAW=/scratch/groups/jzeitzer/UKBB/Data/Raw/Batch_rest/
DATACOMM=/scratch/groups/jzeitzer/UKBB/Data/Commands/Batch_rest/
INPUT=/scratch/groups/jzeitzer/UKBB/Data/Commands/Batch_rest/inputRest.txt

# Export Environment variables
export DATARAW
export DATACOMM
export INPUT

# Chunk input file into 10 jobs
python3 /scratch/groups/jzeitzer/UKBB/Code/ukbb/chunkInput.py

cd $DATARAW

for i in $(seq 0 $(( ${NUMINPUT} - 1 ))); do
    for FILE in input_$i.txt; do
        echo ${FILE}
        if [ $i \> 9 ];
        then
            Nm=$(($i - 10))
            sbatch -n 1 -t 18:00:00 --wrap="./ukbfetch -b${FILE} -ak63099r43661.ukbkey" --job-name=getDATA_${i} --dependency=afterany:getDATA_${Nm}
        else
            sbatch -n 1 -t 18:00:00 --wrap="./ukbfetch -b${FILE} -ak63099r43661.ukbkey" --job-name=getDATA_${i}
        fi;
    done
done
